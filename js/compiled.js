function iG(){var h=0,f=0,b=0,a=0,d=0,j=72,g=50,n=false,o=false;sLX=0,sLY=0;$("#base").on("touchstart mousedown",l);$("#base").on("touchmove mousemove",k);$("#base").on("touchend mouseup",c);function l(p){p.preventDefault();h=p.pageX;f=p.pageY;if(d==0){d=new Date()}else{var q=new Date()-d;if(q>75&&q<300){n=true}else{if(q>300){d=new Date();n=false}else{d=0;n=false}}}}function k(p){p.preventDefault();b=p.pageX;a=p.pageY;setTimeout(function(){if(p.pageY>700&&(p.pageX>b-10&&p.pageX<b+10)){$(".cnContainer").css({visibility:"visible"})}},1000);if(p.pageY<700){$(".cnContainer").css({visibility:"hidden"})}}function c(p,q){p.preventDefault();if(b!=0||a!=0){sLX=Math.abs(b-h);sLY=Math.abs(a-f);if(p.target.className!="cn"){if(sLX>=j||sLY>=g&&a>650){e();m();return}}}setTimeout(function(){var s=$(p.target);if(n&&s[0].className!="cn"){if(s.attr("src").indexOf("-")!=-1){s.attr({src:"img/"+pfx+".jpg"});ix=pfx;pHA($("#slider").children(":first"));lT=false}}else{b=b||h;a=a||f;var r=s[0].parentElement;if(Math.abs(b-h)<5){if(r.className=="thumbnail"){dBT(r.id);lT=true}}}m(p)},300)}function m(p){h=0,f=0;b=0,a=0}function e(){if(h>b){dn(1)}else{dn(-1)}}}var ix=0,pfx=0,iL=tI.length,IMG_WIDTH=1024,IMG_HEIGHT=768,GAP=10,STAR_X=25,H_counter=0,V_counter=0;var lT=false,resumed=false,next,prevStars=0;function rS(){IP="testSite";CURR_USER="album."+IP;pageInfo={cn:"",times:[],stars:0};if(localStorage.getItem(CURR_USER)==null){dd={lP:1,ps:[pageInfo]};localStorage.setItem(CURR_USER,JSON.stringify(dd));prevSessionPage=0}else{dd=JSON.parse(localStorage.getItem(CURR_USER));prevSessionPage=dd.lP}startWatchTime=new Date();html='<div id="sliderContainer">';html+='    <div id="slider">';html+='        <div class="sliderSpot"><img src="img/0.jpg">';html+='            <div class="cnContainer">';html+='                <ul id="stars"></ul>';html+='                <span id="cn"></span>';html+="            </div>";html+="        </div>";html+="     </div>";html+="</div>";$("#base").html(html);slider=$("#slider");cn=$(".cnText");for(i=0;i<5;i++){$("<li/>").css({left:25*i+GAP+"px"}).on("mouseover",function(){$(this).prevAll().andSelf().css({"background-position-y":"-21px"});$(this).nextAll().css({"background-position-y":"0"})}).on("mouseleave",function(){$(this).parent().children().css({"background-position-y":"0"});$(this).parent().children(":lt("+prevStars+")").css({"background-position-y":"-21px"})}).on("click ",function(a){a.stopPropagation();prevStars=$(this).prevAll().andSelf().length;return false}).appendTo($("#stars"))}$(".cnContainer").on("click",function(a){a.stopPropagation();cn.css({visibility:"visible"}).val($("#cn").text()).focus()});$(".sliderSpot").on("click",function(){if(cn.val().length!=0){$("#cn").text(cn.val().trim())}cn.val("").css({visibility:"hidden"})});iG();resumed=true;dn(prevSessionPage)}function dn(a){if(a!=0||!resumed){saveToStorage(ix)}var c=(a)?slider.children(":last"):slider.children(":first");var b=(a)?c.before(c.clone(true)):c.after(c.clone(true));$(".thumbnail",b).remove();$(".cnContainer",b).css({visibility:"hidden"});H_counter+=Number(a);ix=normalizeIndex(ix+Number(a));iL=(lT)?tI[pfx].length:tI.length;if(!lT){pHA(b)}setImage(b,slider,a);slider.animate({left:left+"px"},1000,function(){if(a){slider.children(":first").remove()}else{slider.children(":last").remove()}dd.lP=ix;localStorage.setItem(CURR_USER,JSON.stringify(dd));pC();doCache()})}function doCache(){var a=new Image();$.each(tI[ix],function(b){a.src="img/"+ix+"-"+b+".jpg"});cacheF=normalizeIndex(ix+1);a.src="img/"+cacheF+".jpg";cacheB=normalizeIndex(ix-1);a.src="img/"+cacheB+".jpg"}function normalizeIndex(a){a=a>iL-1?0:a;a=a<0?iL-1:a;return a}function setImage(b,c,a){b.css({left:IMG_WIDTH*H_counter+"px"});$(">img:first",b).attr({src:"img/"+(lT?pfx+"-":"")+ix+".jpg"});left=parseInt(c.css("left"))-a*IMG_WIDTH}function pC(){pageInfo=JSON.parse(localStorage.getItem(CURR_USER)).ps[ix];cC=(!pageInfo)?"":pageInfo.cn;var a=(!pageInfo)?0:pageInfo.stars;$("#stars >li").each(function(b){if(b<a){$(this).css({"background-position-y":"-21px"})}else{$(this).css({"background-position-y":"0"})}});$(".cnContainer").children("span").text(cC)}function pHA(a){$.each(tI[ix],function(b,c){$("<div/>").attr({"class":"thumbnail",id:ix+"-"+b}).css({top:c[1]+"px",left:c[2]+"px",width:c[3]+"px",height:c[4]+"px"}).html(' <img src="img/spacer.gif" style ="width:'+c[3]+"px; height:"+c[4]+'px" >').appendTo(a)});$('img[src$="jpg"]').on("click",function(b){b.stopPropagation?b.stopPropagation():(b.cancelBubble=true)})}function dBT(c){$(".sliderSpot>img").attr({src:"img/"+c+".jpg"});ix=Number(c.split("-")[1]),pfx=Number(c.split("-")[0]);$(".sliderSpot>div").remove();var b=c.split("-")[0];for(i=0;i<tI[b].length;i++){var a=new Image();a.src="img/"+b+"-"+i+".jpg"}}function saveToStorage(a){var b=parseInt((new Date()-startWatchTime)/1000);var c=dd.ps[a];if(!c){dd.ps[a]={cn:"",times:[],stars:0}}dd.ps[a].times.push(b);dd.ps[a].cn=$("#cn").text();dd.ps[a].stars=$.map($("#stars>li"),function(d){return(parseInt($(d).css("background-position-y"))==0)?null:1}).length;dd.lP=a;localStorage.setItem(CURR_USER,JSON.stringify(dd))}rS();